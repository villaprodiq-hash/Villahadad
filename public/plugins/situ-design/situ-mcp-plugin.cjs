(()=>{var e={359:(e,t,n)=>{e.exports=function(){const e=n(630);let t;try{t=n(364).WebSocketServer}catch(e){console.warn("ws package not found, WebSocket servers will not start"),t=null}let o={createdAt:(new Date).toISOString(),offsetEncoding:"utf16",edits:[]},s=null;return{name:"situ-mcp-plugin",apply:"serve",configureServer(n){try{const n=e.createServer((e,t)=>{if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET,POST,OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),"OPTIONS"===e.method)return t.statusCode=204,void t.end();const n=new URL(e.url,"http://127.0.0.1:7124").pathname;if("/health"===n)return t.statusCode=200,t.setHeader("Content-Type","application/json"),void t.end(JSON.stringify({status:"ok"}));if("/edits"===n&&"GET"===e.method)return t.statusCode=200,t.setHeader("Content-Type","application/json"),void t.end(JSON.stringify(o,null,2));if("/selection"===n&&"GET"===e.method)return t.statusCode=200,t.setHeader("Content-Type","application/json"),void t.end(JSON.stringify(s||{target:null,suggestedCssSelectors:[]},null,2));if("/selection_edits"!==n||"GET"!==e.method){if("/update"===n&&"POST"===e.method){let n="";return e.on("data",e=>{n+=e}),void e.on("end",()=>{try{o=JSON.parse(n)}catch(e){}t.statusCode=200,t.setHeader("Content-Type","application/json"),t.end(JSON.stringify({success:!0}))})}if("/selection"===n&&"POST"===e.method){let n="";return e.on("data",e=>{n+=e}),void e.on("end",()=>{try{s=JSON.parse(n)}catch(e){}t.statusCode=200,t.setHeader("Content-Type","application/json"),t.end(JSON.stringify({success:!0}))})}if("/mcp"===n&&"POST"===e.method){let n="";return e.on("data",e=>{n+=e}),void e.on("end",()=>{try{const e=function(e){const{id:t,method:n,params:r}=e,i=e=>({jsonrpc:"2.0",id:t,result:e}),c=(e,n)=>({jsonrpc:"2.0",id:t,error:{code:e,message:n}});switch(n){case"initialize":return i({protocolVersion:"2024-11-05",serverInfo:{name:"situ-design-mcp",version:"1.0.0"},capabilities:{tools:{},resources:{},prompts:{}}});case"tools/list":return i({tools:[{name:"get_edits",description:"Get current staged design changes (MCP envelope)",inputSchema:{type:"object",properties:{}}},{name:"get_selection",description:"Get target information for currently selected element",inputSchema:{type:"object",properties:{}}},{name:"get_selection_edits",description:"Get edits for currently selected element only",inputSchema:{type:"object",properties:{}}}]});case"tools/call":if(r&&"get_edits"===r.name)return i({content:[{type:"text",text:JSON.stringify(o,null,2)}]});if(r&&"get_selection"===r.name)return i({content:[{type:"text",text:JSON.stringify({target:s?.target||null,suggestedCssSelectors:s?.suggestedCssSelectors||[]},null,2)}]});if(r&&"get_selection_edits"===r.name){let e=[];if(s&&s.target&&s.target.elementId){const t=s.target.elementId;e=o.edits.filter(e=>e.locator&&e.locator.elementId===t)}return i({content:[{type:"text",text:JSON.stringify({createdAt:o.createdAt,offsetEncoding:o.offsetEncoding,edits:e},null,2)}]})}return c(-32601,`Tool not found: ${r?.name}`);case"resources/list":return i({resources:[{uri:"situ://edits",name:"Staged Design Changes",description:"Current MCP envelope with staged design changes",mimeType:"application/json"}]});case"resources/read":return r&&"situ://edits"===r.uri?i({contents:[{uri:"situ://edits",mimeType:"application/json",text:JSON.stringify(o,null,2)}]}):c(-32602,"Resource not found");default:return c(-32601,`Method not found: ${n}`)}}(JSON.parse(n));t.statusCode=200,t.setHeader("Content-Type","application/json"),t.end(JSON.stringify(e))}catch(e){t.statusCode=400,t.setHeader("Content-Type","application/json"),t.end(JSON.stringify({jsonrpc:"2.0",id:null,error:{code:-32700,message:"Parse error"}}))}})}t.statusCode=404,t.end("Not found")}else if(t.statusCode=200,t.setHeader("Content-Type","application/json"),s&&s.target&&s.target.elementId){const e=s.target.elementId,n=o.edits.filter(t=>t.locator&&t.locator.elementId===e);t.end(JSON.stringify({...o,edits:n},null,2))}else t.end(JSON.stringify({createdAt:(new Date).toISOString(),offsetEncoding:"utf16",edits:[]},null,2))});if(n.listen(7124,"127.0.0.1",()=>{}),t)try{new t({server:n,path:"/"});const o=e.createServer();new t({server:o,path:"/"}),o.listen(7125,"127.0.0.1",()=>{});const s=e.createServer();new t({server:s,path:"/"}),s.listen(7126,"127.0.0.1",()=>{}),setTimeout(()=>{console.log("  ➜  ✓ Situ MCP (port 7124)"),console.log("  ➜  ✓ Situ WebSockets (port 7125)"),console.log("  ➜  ✓ Situ Editor (port 7126)")},100)}catch(e){console.warn("Failed to start WebSocket servers:",e.message)}else setTimeout(()=>{console.log("  ➜  ✓ Situ MCP (port 7124)")},100)}catch(e){console.warn("Failed to start MCP servers:",e.message)}}}}},364:e=>{"use strict";e.exports=require("ws")},630:e=>{"use strict";e.exports=require("http")}},t={},n=function n(o){var s=t[o];if(void 0!==s)return s.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}(359);module.exports=n})();